# ================================================================================
# TABLES AND SHARDING CONFIGURATION
# Objective: Define table structure, sharding types and relationships
# ================================================================================

database:
  name: "citus_platform"
  description: "Citus Educational Platform"

# Table definitions
tables:
  # ===========================================
  # REFERENCE TABLE (not distributed)
  # ===========================================
  companies:
    description: "Advertising companies"
    type: "reference"  # reference, distributed, local
    columns:
      - name: "id"
        type: "SERIAL PRIMARY KEY"
        description: "Company unique ID"
      - name: "name"
        type: "VARCHAR(255) NOT NULL"
        description: "Company name"
      - name: "industry"
        type: "VARCHAR(100)"
        description: "Industry sector"
      - name: "country"
        type: "VARCHAR(100)"
        description: "Country of origin"
      - name: "created_at"
        type: "TIMESTAMP DEFAULT CURRENT_TIMESTAMP"
        description: "Creation date"
    indexes:
      - name: "idx_companies_industry"
        columns: ["industry"]
      - name: "idx_companies_country"
        columns: ["country"]
    data_file: "companies.csv"

  # ===========================================
  # TABLE DISTRIBUTED BY COMPANY_ID
  # ===========================================
  campaigns:
    description: "Advertising campaigns"
    type: "distributed"
    shard_key: "company_id"  # Column for sharding
    shard_count: 8          # Number of shards
    replication_factor: 1    # Replication factor
    columns:
      - name: "id"
        type: "SERIAL"
        description: "Campaign unique ID"
      - name: "company_id"
        type: "INTEGER NOT NULL"
        description: "Company ID (shard key)"
      - name: "name"
        type: "VARCHAR(255) NOT NULL"
        description: "Campaign name"
      - name: "budget"
        type: "DECIMAL(12,2)"
        description: "Campaign budget"
      - name: "status"
        type: "VARCHAR(20) DEFAULT 'active'"
        description: "Campaign status"
      - name: "start_date"
        type: "DATE"
        description: "Start date"
      - name: "end_date"
        type: "DATE"
        description: "End date"
      - name: "created_at"
        type: "TIMESTAMP DEFAULT CURRENT_TIMESTAMP"
        description: "Creation date"
    primary_key: ["id", "company_id"]  # Composite primary key
    foreign_keys:
      - column: "company_id"
        references: "companies(id)"
    indexes:
      - name: "idx_campaigns_status"
        columns: ["status"]
      - name: "idx_campaigns_dates"
        columns: ["start_date", "end_date"]
    data_file: "campaigns.csv"

  # ===========================================
  # TABLE DISTRIBUTED BY COMPANY_ID (colocated)
  # ===========================================
  ads:
    description: "Individual advertisements"
    type: "distributed"
    shard_key: "company_id"
    shard_count: 8
    replication_factor: 1
    colocated_with: "campaigns"  # Colocation for efficient JOINs
    columns:
      - name: "id"
        type: "SERIAL"
        description: "Ad unique ID"
      - name: "campaign_id"
        type: "INTEGER NOT NULL"
        description: "Campaign ID"
      - name: "company_id"
        type: "INTEGER NOT NULL"
        description: "Company ID (shard key)"
      - name: "title"
        type: "VARCHAR(255) NOT NULL"
        description: "Ad title"
      - name: "content"
        type: "TEXT"
        description: "Ad content"
      - name: "clicks"
        type: "INTEGER DEFAULT 0"
        description: "Number of clicks"
      - name: "impressions"
        type: "INTEGER DEFAULT 0"
        description: "Number of impressions"
      - name: "cost"
        type: "DECIMAL(10,2)"
        description: "Ad cost"
      - name: "created_at"
        type: "TIMESTAMP DEFAULT CURRENT_TIMESTAMP"
        description: "Creation date"
    primary_key: ["id", "company_id"]
    foreign_keys:
      - column: "campaign_id"
        references: "campaigns(id)"
      - column: "company_id"
        references: "companies(id)"
    indexes:
      - name: "idx_ads_campaign"
        columns: ["campaign_id"]
      - name: "idx_ads_performance"
        columns: ["clicks", "impressions"]
    data_file: "ads.csv"

  # ===========================================
  # LOCAL TABLE (for demonstration only)
  # ===========================================
  system_metrics:
    description: "System metrics (local table)"
    type: "local"
    columns:
      - name: "id"
        type: "SERIAL PRIMARY KEY"
        description: "Metric unique ID"
      - name: "metric_name"
        type: "VARCHAR(100) NOT NULL"
        description: "Metric name"
      - name: "metric_value"
        type: "DECIMAL(15,2)"
        description: "Metric value"
      - name: "collected_at"
        type: "TIMESTAMP DEFAULT CURRENT_TIMESTAMP"
        description: "Collection timestamp"
    indexes:
      - name: "idx_metrics_name_time"
        columns: ["metric_name", "collected_at"]
    data_file: "system_metrics.csv"

# ===========================================
# SHARDING CONFIGURATIONS
# ===========================================
sharding:
  default_shard_count: 4
  default_replication_factor: 1
  colocated_tables:
    - ["campaigns", "ads"]  # Colocated tables for efficient JOINs

# ===========================================
# PERFORMANCE CONFIGURATIONS
# ===========================================
performance:
  enable_columnar: false  # Enable columnar extension (Citus 10+)
  enable_compression: false
  work_mem: "256MB"
  shared_buffers: "512MB"
